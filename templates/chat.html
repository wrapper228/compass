<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Compass Chat</title>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <style>
      body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, sans-serif; max-width: 840px; margin: 24px auto; padding: 0 12px}
      .msg{padding:10px 12px; border-radius:10px; margin:8px 0}
      .user{background:#eef;}
      .assistant{background:#efe;}
      .row{display:flex; gap:8px}
      textarea{width:100%; height:90px}
      button{padding:8px 12px}
      .meta{color:#666; font-size:12px}
    </style>
  </head>
  <body>
    <h1>Compass Chat</h1>
    <div id="log"></div>
    <form id="f" hx-post="/api/chat/generate" hx-trigger="submit" hx-target="#resp" hx-swap="innerHTML">
      <div class="row">
        <textarea name="payload" placeholder='{"messages":[{"role":"user","content":"Привет"}]}'></textarea>
        <button type="submit">Отправить</button>
      </div>
      <div class="meta">Отправляется JSON тела запроса для /api/chat/generate</div>
    </form>
    <pre id="resp"></pre>
    <script>
      const form = document.getElementById('f');
      form.addEventListener('htmx:configRequest', (e) => {
        try {
          const data = JSON.parse(form.querySelector('textarea').value);
          e.detail.headers['Content-Type'] = 'application/json';
          e.detail.parameters = {};
          e.detail.fetchOpts.body = JSON.stringify(data);
        } catch (err) {
          alert('Некорректный JSON');
          e.preventDefault();
        }
      });
    </script>
  </body>
  </html>


